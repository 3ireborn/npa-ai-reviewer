<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NPA AI Reviewer</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="icon" type="image/png" href="favicon.png" />
</head>

<body class="bg-slate-100">
  <div class="max-w-xl mx-auto p-4">

    <!-- Header -->
    <div class="text-center mb-6">
      <img src="favicon.png" class="w-16 mx-auto mb-2" />
      <h1 class="text-2xl font-bold text-slate-800">NPA AI Reviewer</h1>
      <p class="text-sm text-slate-500">Upload gambar, lalu biarkan AI bantu kamu ðŸ™Œ</p>
    </div>

    <!-- Upload -->
    <label class="block mb-2 text-sm font-medium text-slate-700">Upload Gambar</label>
    <div class="border border-dashed rounded-xl p-4 bg-white">
      <input type="file" accept="image/*" onchange="previewImage(event)" />
      <div id="preview" class="mt-3"></div>
    </div>

    <!-- Form -->
    <div class="mt-5">
      <label class="text-sm font-medium">Nama Produk / Orang</label>
      <input id="name" class="w-full p-2 border rounded-lg mt-1" placeholder="Isi nama konten..." />

      <label class="text-sm font-medium mt-4 block">Tipe Konten</label>
      <select id="type" class="w-full p-2 border rounded-lg mt-1">
        <option>Motivasi</option>
        <option>UMKM</option>
        <option>Personal</option>
        <option>Campuran</option>
      </select>

      <label class="text-sm font-medium mt-4 block">Gaya Narasi</label>
      <select id="tone" class="w-full p-2 border rounded-lg mt-1">
        <option>Santai</option>
        <option>Inspiratif</option>
        <option>Profesional</option>
        <option>Friendly</option>
      </select>

      <label class="text-sm font-medium mt-4 block">Link Referral (opsional)</label>
      <input id="referral" class="w-full p-2 border rounded-lg mt-1" placeholder="https://linkmu.com" />

      <button id="generateBtn" onclick="generateText()"
        class="w-full bg-blue-600 text-white py-3 rounded-lg mt-6 font-semibold hover:bg-blue-700">
        Generate Narasi AI
      </button>
    </div>

    <!-- OUTPUT -->
    <div id="output" class="mt-8 hidden">
      <h2 class="text-xl font-bold mb-3 text-slate-700">ðŸŽ‰ Hasil Generasi AI</h2>

      <!-- Komentar -->
      <h3 class="font-semibold text-slate-700 mt-4">Komentar Meta-Friendly:</h3>
      <div id="comment"></div>

      <!-- Caption -->
      <h3 class="font-semibold text-slate-700 mt-6">Caption:</h3>
      <div id="caption"></div>

      <!-- Hashtags -->
      <h3 class="font-semibold text-slate-700 mt-6">Hashtag:</h3>
      <div id="hashtags" class="mt-2"></div>

      <!-- Meta advice -->
      <div id="metaAdvice" class="text-xs text-slate-500 mt-4"></div>
    </div>

    <p class="text-center text-xs text-slate-500 mt-10">
      Powered by <b>NPA Smart System</b> Â© 2025
    </p>
  </div>

  <!-- ================================================================= -->
  <!-- SCRIPT BARU -->
  <!-- ================================================================= -->
  <script>
    const previewEl = document.getElementById('preview');
    const outputEl = document.getElementById('output');
    const commentEl = document.getElementById('comment');
    const captionEl = document.getElementById('caption');
    const hashtagsEl = document.getElementById('hashtags');
    const generateBtn = document.getElementById('generateBtn');

    let currentImageBase64 = null;

    function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function () {
        currentImageBase64 = reader.result.split(',')[1];
        previewEl.innerHTML = `<img src="${reader.result}" class="rounded-xl shadow mt-2" />`;
      };
      reader.readAsDataURL(event.target.files[0]);
    }

    async function generateText() {
      const name = document.getElementById('name').value.trim();
      const type = document.getElementById('type').value;
      const tone = document.getElementById('tone').value;
      const referral = document.getElementById('referral').value.trim();

      generateBtn.disabled = true;
      generateBtn.innerText = "Memproses...";

      try {
        const resp = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            imageBase64: currentImageBase64,
            name,
            type,
            tone,
            referral
          })
        });

        const data = await resp.json();

        // ================= KOMENTAR ==================
        commentEl.innerHTML = "";
        data.commentVariants.forEach((cmt, i) => {
          commentEl.innerHTML += `
            <div class="mt-3 p-3 bg-white rounded border">
              <div class="text-xs text-slate-500 mb-1">Variant ${i+1}</div>
              ${cmt.replace(/\n/g, "<br>")}
              <button class="mt-2 px-2 py-1 text-sm border rounded copy-btn"
                data-text="${encodeURIComponent(cmt)}">Copy</button>
            </div>
          `;
        });

        // ================= CAPTION ==================
        captionEl.innerHTML = "";
        data.captionVariants.forEach((cap, i) => {
          captionEl.innerHTML += `
            <div class="mt-3 p-3 bg-white rounded border">
              <div class="text-xs text-slate-500 mb-1">Variant ${i+1}</div>
              ${cap.replace(/\n/g, "<br>")}
              <button class="mt-2 px-2 py-1 text-sm border rounded copy-btn"
                data-text="${encodeURIComponent(cap)}">Copy</button>
            </div>
          `;
        });

        // ================= HASHTAG ==================
        hashtagsEl.innerHTML = `
          <div class="p-3 bg-white rounded border">${data.hashtags.join(" ")}</div>
        `;

        document.querySelectorAll(".copy-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            navigator.clipboard.writeText(decodeURIComponent(btn.dataset.text));
            alert("Berhasil dicopy âœ¨");
          });
        });

        outputEl.classList.remove("hidden");

      } catch (err) {
        alert("Terjadi kesalahan: " + err.message);
      }

      generateBtn.disabled = false;
      generateBtn.innerText = "Generate Narasi AI";
    }
  </script>
</body>
</html>
