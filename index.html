<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NPA AI Reviewer â€” Dark Neon</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg-1: #06070a;     /* deep background */
      --bg-2: #07101a;
      --card: rgba(10,12,16,0.86);
      --muted: #9aa7bb;
      --accent: #A78BFA;   /* purple accent */
      --input-yellow: #facc15;
      --neon-blue: #3b82f6;
      --neon-red: #f43f5e;
      --neon-yellow: #facc15;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(59,130,246,0.06), transparent 10%),
                  radial-gradient(900px 450px at 90% 90%, rgba(164,99,255,0.04), transparent 12%),
                  linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* neon border card (full glow) */
    .neon-card {
      position: relative;
      border-radius: 16px;
      overflow: visible;
      isolation:isolate;
    }
    .neon-card::before {
      content: "";
      position: absolute;
      inset: -1px;
      z-index: 0;
      border-radius: 18px;
      padding:1px;
      background: conic-gradient(from 180deg at 50% 50%, var(--neon-blue), var(--neon-red), var(--neon-yellow), var(--neon-blue));
      filter: blur(10px) saturate(140%);
      opacity: 0.95;
      transform: translateZ(0);
    }
    .neon-card > .card-inner {
      position: relative;
      z-index: 2;
      border-radius: 15px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 8px 40px rgba(10,12,16,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }

    /* Input glow */
    .neon-input {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      color: #f1f5f9;
      box-shadow: 0 6px 18px rgba(167,139,250,0.06), 0 0 10px rgba(59,130,246,0.02);
    }
    .neon-input:focus {
      outline: none;
      box-shadow: 0 6px 30px rgba(167,139,250,0.16), 0 0 14px rgba(59,130,246,0.18);
      border-color: rgba(167,139,250,0.7);
    }

    /* bright yellow input style */
    .yellow-input {
      background: linear-gradient(180deg, rgba(250, 246, 210, 0.06), rgba(250, 246, 210, 0.02));
      color: #0b0b0b;
      border: 1px solid rgba(250, 246, 210, 0.12);
      box-shadow: 0 6px 26px rgba(250, 204, 21, 0.09);
    }
    .yellow-input:focus {
      box-shadow: 0 8px 36px rgba(250,204,21,0.24), 0 0 18px rgba(244,63,94,0.06);
      border-color: rgba(250,204,21,0.9);
    }

    .btn-accent {
      background: linear-gradient(90deg, #7c3aed, #3b82f6);
      color: #07101a;
      font-weight: 700;
      box-shadow: 0 8px 30px rgba(123,65,255,0.18), 0 0 18px rgba(59,130,246,0.12);
    }
    .btn-accent:hover { filter: brightness(1.05); transform: translateY(-2px); transition: .18s ease; }

    /* small card neon outlines for inner blocks */
    .inner-block {
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: 0 6px 18px rgba(10,12,16,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }

    .copy-btn {
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      color: var(--muted);
    }

    /* responsiveness small tweaks */
    @media (max-width:640px) {
      .neon-card::before { filter: blur(8px); }
    }
  </style>
</head>

<body class="min-h-screen flex items-start justify-center py-10 px-4">

  <div class="w-full max-w-3xl">
    <div class="neon-card">
      <div class="card-inner">

        <!-- HEADER -->
        <div class="flex items-center gap-4 mb-4">
          <img src="favicon.png" class="h-12 w-12 rounded-full shadow" alt="logo" />
          <div>
            <h1 class="text-2xl font-semibold">NPA AI Reviewer</h1>
            <div class="text-sm" style="color:var(--muted)">Dark Neon Â· Auto caption HOOK â†’ MASALAH â†’ SOLUSI â†’ CTA</div>
          </div>
        </div>

        <!-- FORM GRID -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

          <div class="md:col-span-2">
            <label class="text-xs" style="color:var(--muted)">Nama Produk / Judul</label>
            <input id="name" placeholder="Judul atau nama (boleh kosong)" class="mt-2 w-full p-3 rounded-lg neon-input" />
          </div>

          <div>
            <label class="text-xs" style="color:var(--muted)">Preset Nama</label>
            <select id="preset" class="mt-2 w-full p-3 rounded-lg neon-input">
              <option value="">â€” Pilih Preset (opsional) â€”</option>
              <option>Motivasi Pagi</option>
              <option>Semangat Bangkit</option>
              <option>Ngopi Bareng</option>
              <option>UMKM Lokal</option>
              <option>Perjalanan Hidup</option>
              <option>Edukasi Ringan</option>
              <option>Sharing Insight</option>
              <option>Proses Berkarya</option>
              <option>Tips Produktif</option>
              <option>Konten Harian</option>
              <option value="__custom__">â€” Custom â€”</option>
            </select>
          </div>

        </div>

        <!-- manual name (always visible) -->
        <div class="mt-4">
          <label class="text-xs" style="color:var(--muted)">Nama / Keterangan (editable)</label>
          <input id="nameManual" placeholder="Contoh: Ngopi bareng sama PakD" class="mt-2 w-full p-3 rounded-lg neon-input" />
        </div>

        <!-- options row -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="text-xs" style="color:var(--muted)">Tipe Konten</label>
            <select id="type" class="mt-2 w-full p-3 rounded-lg neon-input">
              <option>Campuran</option>
              <option>Motivasi</option>
              <option>UMKM</option>
              <option>Personal</option>
              <option>Review Produk</option>
            </select>
          </div>

          <div>
            <label class="text-xs" style="color:var(--muted)">Gaya Narasi</label>
            <select id="tone" class="mt-2 w-full p-3 rounded-lg neon-input">
              <option>Inspiratif</option>
              <option>Santai</option>
              <option>Profesional</option>
              <option>Friendly</option>
            </select>
          </div>

          <div>
            <label class="text-xs" style="color:var(--muted)">Link Referral (opsional)</label>
            <input id="referral" placeholder="s.id/..." class="mt-2 w-full p-3 rounded-lg yellow-input" />
          </div>
        </div>

        <!-- image upload -->
        <div class="mt-4 inner-block p-4">
          <label class="text-xs" style="color:var(--muted)">Upload Gambar</label>
          <div class="mt-2">
            <input id="imageInput" type="file" accept="image/*" onchange="previewImage(event)" class="text-sm text-[var(--muted)]" />
            <div id="preview" class="mt-3"></div>
          </div>
        </div>

        <!-- buttons -->
        <div class="mt-6 flex items-center gap-3">
          <button id="generateBtn" onclick="generateText()" class="btn-accent px-6 py-3 rounded-lg">Generate Narasi AI</button>
          <button onclick="resetForm()" class="px-4 py-2 rounded-lg border border-[rgba(255,255,255,0.06)] text-[var(--muted)]">Reset</button>
          <div class="ml-auto text-xs" style="color:var(--muted)">Powered by <b style="color:var(--accent)">NPA Smart System</b></div>
        </div>

      </div> <!-- /card-inner -->
    </div> <!-- /neon-card -->

    <!-- OUTPUT -->
    <div id="outputCard" class="mt-6 neon-card" style="display:none">
      <div class="card-inner">
        <h2 class="text-lg font-semibold mb-3">ðŸŽ¯ Hasil Generasi</h2>

        <div class="grid gap-4">
          <div>
            <div class="text-xs" style="color:var(--muted)">Komentar (varian)</div>
            <div id="comment" class="space-y-3 mt-2"></div>
          </div>

          <div>
            <div class="text-xs" style="color:var(--muted)">Caption (varian)</div>
            <div id="caption" class="space-y-3 mt-2"></div>
          </div>

          <div>
            <div class="text-xs" style="color:var(--muted)">Hashtags</div>
            <div id="hashtags" class="p-3 rounded bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.03)] mt-2" style="color:var(--muted)"></div>
          </div>

          <div>
            <div id="metaAdvice" class="text-xs" style="color:var(--muted)"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- SCRIPT -->
  <script>
    // Elements
    const preset = document.getElementById('preset');
    const nameManual = document.getElementById('nameManual');
    const nameMain = document.getElementById('name');
    const preview = document.getElementById('preview');
    const outputCard = document.getElementById('outputCard');
    const commentEl = document.getElementById('comment');
    const captionEl = document.getElementById('caption');
    const hashtagsEl = document.getElementById('hashtags');
    const metaAdviceEl = document.getElementById('metaAdvice');

    // sync preset -> nameManual and nameMain
    preset.addEventListener('change', () => {
      const v = preset.value;
      if (v === "__custom__") {
        nameManual.value = "";
        nameMain.value = "";
        nameManual.focus();
      } else {
        nameManual.value = v;
        nameMain.value = v;
      }
    });

    // manual input reflects to main
    nameManual.addEventListener('input', () => {
      nameMain.value = nameManual.value;
    });

    // image preview base64
    let currentImageBase64 = null;
    function previewImage(event) {
      const f = event.target.files?.[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        preview.innerHTML = `<img src="${reader.result}" class="rounded-lg max-h-48 object-contain border border-[rgba(255,255,255,0.03)]" />`;
        currentImageBase64 = reader.result.split(',')[1];
      };
      reader.readAsDataURL(f);
    }

    function resetForm() {
      preset.value = "";
      nameManual.value = "";
      nameMain.value = "";
      document.getElementById('type').value = "Campuran";
      document.getElementById('tone').value = "Inspiratif";
      document.getElementById('referral').value = "";
      document.getElementById('imageInput').value = "";
      preview.innerHTML = "";
      outputCard.style.display = 'none';
      commentEl.innerHTML = "";
      captionEl.innerHTML = "";
      hashtagsEl.innerHTML = "";
      metaAdviceEl.innerText = "";
    }

    // generate
    async function generateText() {
      const name = nameMain.value.trim() || nameManual.value.trim() || "Konten Kamu";
      const type = document.getElementById('type').value || "Campuran";
      const tone = document.getElementById('tone').value || "Inspiratif";
      const referral = document.getElementById('referral').value.trim();

      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      btn.innerText = "Memproses...";

      try {
        const resp = await fetch('/api/generate', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            imageBase64: currentImageBase64,
            name, type, tone, referral
          })
        });

        if (!resp.ok) {
          const txt = await resp.text();
          throw new Error(txt || 'Server error');
        }

        const data = await resp.json();

        // render comments: append referral link only to variant 2 (index 1)
        commentEl.innerHTML = "";
        data.commentVariants.forEach((cmt, i) => {
          let html = `<div class="p-3 rounded-lg bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.03)]">
                        <div class="text-xs" style="color:var(--muted);margin-bottom:6px">Variant ${i+1}</div>
                        <div style="white-space:pre-wrap;color:#eaf0ff">${cmt}</div>
                        <div class="mt-2"><button class="copy-btn px-3 py-1 rounded border" data-text="${encodeURIComponent(cmt)}" style="background:transparent;color:var(--muted)">Copy</button></div>
                      </div>`;

          if (i === 1 && data.referralLink) {
            const linkHtml = `<div class="mt-2 text-xs" style="color:var(--muted)">Info lengkap di sini: <a href="${data.referralLink}" target="_blank" rel="noopener" style="color:var(--accent)">${data.referralLink}</a></div>`;
            html = html.replace('</div></div>', linkHtml + '</div></div>');
          }

          commentEl.innerHTML += html;
        });

        // render captions (no link)
        captionEl.innerHTML = "";
        data.captionVariants.forEach((cap, i) => {
          captionEl.innerHTML += `<div class="p-3 rounded-lg bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.03)]">
                                    <div class="text-xs" style="color:var(--muted);margin-bottom:6px">Variant ${i+1}</div>
                                    <div style="white-space:pre-wrap;color:#eaf0ff">${cap}</div>
                                    <div class="mt-2"><button class="copy-btn px-3 py-1 rounded border" data-text="${encodeURIComponent(cap)}" style="background:transparent;color:var(--muted)">Copy</button></div>
                                  </div>`;
        });

        // hashtags & advice
        hashtagsEl.innerText = data.hashtags.join(' ');
        metaAdviceEl.innerText = data.metaAdvice || '';

        // attach copy handlers
        document.querySelectorAll('.copy-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const t = decodeURIComponent(btn.getAttribute('data-text'));
            navigator.clipboard.writeText(t).then(()=> {
              alert('Teks di-copy âœ…');
            });
          });
        });

        outputCard.style.display = 'block';
        window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});

      } catch (err) {
        console.error(err);
        alert('Gagal generate: ' + (err.message || err));
      } finally {
        btn.disabled = false;
        btn.innerText = "Generate Narasi AI";
      }
    }
  </script>

</body>
</html>
